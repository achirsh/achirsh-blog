<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <script type="application/javascript" src='https://blog.achirsh.site/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://blog.achirsh.site/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/github.min.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/github-style.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/light.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/dark.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/syntax.css' />
    <title>Go Modules - achirsh blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="Go" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://blog.achirsh.site/post/go/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Go Modules - achirsh blog" />
<meta name="twitter:description"
  content="Go" />
<meta name="twitter:site" content="https://blog.achirsh.site/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://blog.achirsh.site/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Go Modules - achirsh blog">
<meta property="og:description"
  content="Go" />
<meta property="og:url" content="https://blog.achirsh.site/post/go/" />
<meta property="og:site_name" content="Go Modules" />
<meta property="og:image"
  content="https://blog.achirsh.site/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2022-03-07 00:00:00 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on" style="justify-content: space-between;">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://blog.achirsh.site/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>

    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://blog.achirsh.site/">
                  <img class=" avatar-user"
                    src="https://blog.achirsh.site/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://blog.achirsh.site/">achirsh</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://blog.achirsh.site/post/go/">Go Modules</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Mon, 07 Mar 2022 00:00:00 &#43;0000"
                    class="no-wrap">
                    Mon, 07 Mar 2022 00:00:00 &#43;0000</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" class="btn btn-octicon m-0 mr-2 p-2" aria-haspopup="menu" aria-label="Table of Contents" role="button">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                          1975 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><h1 id="go-modules">Go Modules</h1>
<p>Go Modules是Go语言中正式官宣的项目依赖解决方案，与Go1.11正式发布，在Go1.14可以用在生产上。</p>
<h2 id="什么是go-modules">什么是Go Modules</h2>
<p>Go Modules是Go语言的依赖解决方案，发布于Go1.11，成长于Go1.12，丰富于Go1.13，正式于1.14推荐在生产上使用。</p>
<p>Go Modules目前集成在Go的工具链中，只要安装了Go，自然而然也就可以使用Go Modules了，而Go Modules的出现也解决了在Go1.11前的几个常见争议问题：</p>
<pre tabindex="0"><code>1、Go语言长久以来的依赖管理问题
2、“淘汰”现有的GOPATH的使用模式
</code></pre><h2 id="gopath的那些点点滴滴">GOPATH的那些点点滴滴</h2>
<p>我们有提到Go Modules的解决的问题之一就是“淘汰掉”GOPATH，但是GOPATH又是什么呢。</p>
<h3 id="gopath是什么">GOPATH是什么</h3>
<p>我们先看看第一个问题，GOPATH是什么，我们可以输入命令行看看:</p>
<pre tabindex="0"><code>$ go env
GOPATH=&#34;/Users/xxx/Desktop/PROJECT/go&#34;
</code></pre><p>我们输入go env命令行后可以查看到GOPATH变量的结果，我们进入到该目录下进行查看，如下：</p>
<pre tabindex="0"><code>go
--bin
--pkg
--src
  --github.com
</code></pre><p>GOPATH目录下一共包含了三个字目录，分别是：</p>
<pre tabindex="0"><code>bin：存储所编译生成的二进制文件。
pkg：存储预编译的目标文件，以加快程序的后续编译速度。
src：存储所有.go文件或源代码。在编写GO应用程序，程序包和库时，一般会以$GOPATH/src/github.com/的路径进行存放。
</code></pre><h3 id="为什么启用gopath模式">为什么启用GOPATH模式</h3>
<p>在GOPATH的$GOPATH/src下进行.go文件或源代码的存储，我们可以称其为GOPATH的模式，这个模式，看起来好像没有什么问题，那么为什么我们要启用呢，参见如下原因：</p>
<pre tabindex="0"><code>GOPATH模式下没有版本控制的概念，具有致命的缺陷，至少会造成以下问题：

  1、在执行go get的时候，你无法传达任何版本信息的期望，也就是说你无法知道自己当前更新的事哪一个版本，也无法通过指定来拉取自己所期望的具体版本。
  2、在运动Go应用程序的时候，你无法保证其它人与你所期望依赖的第三方库时相同的版本，也就是说在项目依赖库的管理上，你无法保证所有人的依赖版本都一致。
  3、你没办法处理v1、v2、v3等等不同版本的引用问题，因为GOPATH模式下的导入路径都是一样的，都是github.com/..

Go语言官方从Go1.11起开始推进Go Modules，Go1.13起不再推荐使用GOPATH的使用模式，Go Modules也渐趋稳定，因为新项目也没有必要继续使用GOPATH模式。
</code></pre><h2 id="go-modules基本使用">Go Modules基本使用</h2>
<p>在初步了解了Go Modules的前世今生后，我们正式进入到Go Modules的使用，首先我们将从头开始创建一个Go Modules的项目（原则上所创建的目录应该不要放在GOPATH之中）</p>
<h3 id="所提供的命令">所提供的命令</h3>
<p>在Go Modules中，我们能够使用如下命令进行操作：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>go mod init</td>
<td>生成go.mod文件</td>
</tr>
<tr>
<td>go mod download</td>
<td>下载go.mod文件中指明的所以依赖</td>
</tr>
<tr>
<td>go mod tidy</td>
<td>整理现有的依赖</td>
</tr>
<tr>
<td>go mod graph</td>
<td>查看现有的依赖结构</td>
</tr>
<tr>
<td>go mod edit</td>
<td>编辑go.mod文件</td>
</tr>
<tr>
<td>go mod vendor</td>
<td>导出项目所有的依赖到vendor目录</td>
</tr>
<tr>
<td>go mod verify</td>
<td>检验一个模块是否被篡改过</td>
</tr>
<tr>
<td>go mod why</td>
<td>查看为什么需要依赖某模块</td>
</tr>
</tbody>
</table>
<h3 id="所提供的环境变量">所提供的环境变量</h3>
<p>在Go Modules中有如下常用环境变量，我们可以通过go env命令来查看</p>
<pre tabindex="0"><code>$ go env
GO111MODULE=&#34;auto&#34;
GOPROXY=&#34;https://proxy.golang.org,direct&#34;
GONOPROXY=&#34;&#34;
GOSUMDB=&#34;sum.golang.org&#34;
GONOSUMDB=&#34;&#34;
</code></pre><h3 id="go111module">GO111MODULE</h3>
<p>Go语言提供了GO111MODULE这个环境变量来作为Go Modules的开关，其允许设置以下参数：</p>
<pre tabindex="0"><code>auto：只要项目包含了go.mod文件的话启用Go Modules，目前在Go1.11至Go1.14中仍然是默认值。
on：启用Go Modules，推荐设置，将会是未来版本中的默认值。
off：禁用Go Modules，不推荐设置。
</code></pre><h3 id="goproxy">GOPROXY</h3>
<p>这个环境变量主要是用于设置Go模块代理（Go module proxy），其作用是用于使Go在后续拉取模块版本时能够脱离传统的VCS方式，直接通过镜像站点来快速拉取。</p>
<p>GOPROXY默认值是：https://proxy.golang.org,direct，这有一个很严重的问题，就是proxy.golang.org在国内是无法访问的，因此这会直接卡住你的第一步，所以你必须开启Go modules的同时设置国内的Go模块代理，执行如下命令：</p>
<pre tabindex="0"><code>$ go env -w GOPROXY=https://goproxy.cn,direct
</code></pre><p>GOPROXY 的值是一个以英文逗号 “,” 分割的 Go 模块代理列表，允许设置多个模块代理，假设你不想使用，也可以将其设置为 “off” ，这将会禁止 Go 在后续操作中使用任何 Go 模块代理。</p>
<h4 id="direct是什么">direct是什么</h4>
<p>而在刚刚设置的值中，我们可以发现值列表中有 “direct” 标识，它又有什么作用呢？</p>
<p>实际上 “direct” 是一个特殊指示符，用于指示 Go 回源到模块版本的源地址去抓取（比如 GitHub 等），场景如下：当值列表中上一个 Go 模块代理返回 404 或 410 错误时，Go 自动尝试列表中的下一个，遇见 “direct” 时回源，也就是回到源地址去抓取，而遇见 EOF 时终止并抛出类似 “invalid version: unknown revision&hellip;” 的错误。</p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script>
 
 
 
 window.onload = function () {
   const header = document.getElementById('post-header');
   const headerHeight = header.offsetHeight;
   
   document.documentElement.style.scrollPaddingTop = headerHeight + 10 + "px";
 }

 const tocToggleButton = document.getElementById("toc-toggle");

 const tippyInstance = tippy('#toc-toggle', {
  trigger: 'click',
  content: '<div id="table-of-contents">\u003cnav id=\u0022TableOfContents\u0022\u003e\n  \u003cul\u003e\n    \u003cli\u003e\u003ca href=\u0022#什么是go-modules\u0022\u003e什么是Go Modules\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#gopath的那些点点滴滴\u0022\u003eGOPATH的那些点点滴滴\u003c\/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\u0022#gopath是什么\u0022\u003eGOPATH是什么\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#为什么启用gopath模式\u0022\u003e为什么启用GOPATH模式\u003c\/a\u003e\u003c\/li\u003e\n      \u003c\/ul\u003e\n    \u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#go-modules基本使用\u0022\u003eGo Modules基本使用\u003c\/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\u0022#所提供的命令\u0022\u003e所提供的命令\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#所提供的环境变量\u0022\u003e所提供的环境变量\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#go111module\u0022\u003eGO111MODULE\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#goproxy\u0022\u003eGOPROXY\u003c\/a\u003e\u003c\/li\u003e\n      \u003c\/ul\u003e\n    \u003c\/li\u003e\n  \u003c\/ul\u003e\n\u003c\/nav\u003e</div>',
  allowHTML: true,
  placement: 'bottom-start',
  interactive: true,
  arrow: false,
  maxWidth: "none",
  onHide: function () { tocToggleButton.classList.remove("hover"); },
  onShow: function () { tocToggleButton.classList.add("hover"); },
  onShown: function () {
    selectTableOfContentsOption();

    if (window.hasSetupTableOfContentsListeners) {
      return;
    }

    const tableOfContents = document.getElementById("table-of-contents");
    tableOfContents.addEventListener('click', function () {
      
      tippyInstance[0].hide();
    });

    window.hasSetupTableOfContentsListeners = true;
  }
 });

 function selectTableOfContentsOption () {
   const optionSelectedClass = 'table-of-contents-option-selected';

   const tableOfContentsOptions = document.querySelectorAll("#table-of-contents > nav > ul li");

   for (const option of tableOfContentsOptions) {
     

     const [child] = option.children;
     if (child.tagName.toLowerCase() !== 'a') {
       continue;
     }

     if (window.location.href === child.href) {
       child.classList.add(optionSelectedClass);
     } else {
       child.classList.remove(optionSelectedClass);
     }
   }
 }

 window.onhashchange = selectTableOfContentsOption;
</script>


</body>

<script type="application/javascript" src="https://blog.achirsh.site/js/github-style.js"></script>



</html>