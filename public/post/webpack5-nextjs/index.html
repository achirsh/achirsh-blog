<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <script type="application/javascript" src='https://blog.achirsh.site/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://blog.achirsh.site/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/github.min.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/github-style.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/light.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/dark.css' />
    <link rel="stylesheet" href='https://blog.achirsh.site/css/syntax.css' />
    <title>åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯ - achirsh blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://blog.achirsh.site/post/webpack5-nextjs/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯ - achirsh blog" />
<meta name="twitter:description"
  content="åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯" />
<meta name="twitter:site" content="https://blog.achirsh.site/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://blog.achirsh.site/">


<meta property="og:type" content="article" />
<meta property="og:title" content="åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯ - achirsh blog">
<meta property="og:description"
  content="åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯" />
<meta property="og:url" content="https://blog.achirsh.site/post/webpack5-nextjs/" />
<meta property="og:site_name" content="åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯" />
<meta property="og:image"
  content="https://blog.achirsh.site/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2021-09-14 00:00:00 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on" style="justify-content: space-between;">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://blog.achirsh.site/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>

    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://blog.achirsh.site/">
                  <img class=" avatar-user"
                    src="https://blog.achirsh.site/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://blog.achirsh.site/">achirsh</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://blog.achirsh.site/post/webpack5-nextjs/">åœ¨NextJSä¸­ä½¿ç”¨Webpack5çš„å¾®å‰ç«¯</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 14 Sep 2021 00:00:00 &#43;0000"
                    class="no-wrap">
                    Tue, 14 Sep 2021 00:00:00 &#43;0000</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" class="btn btn-octicon m-0 mr-2 p-2" aria-haspopup="menu" aria-label="Table of Contents" role="button">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                          2581 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><h1 id="åœ¨nextjsä¸­ä½¿ç”¨webpack-5çš„å¾®å‰ç«¯ç›®å‰åœ¨nextjsä¸­ä½¿ç”¨webpack5">åœ¨NextJSä¸­ä½¿ç”¨Webpack 5çš„å¾®å‰ç«¯ï¼ˆç›®å‰åœ¨nextjsä¸­ä½¿ç”¨webpack5ï¼‰</h1>
<p>Webpack5çš„è”åˆæ¨¡å—ä½¿ç”¨ä½¿åˆ›å»ºå¾®å‰ç«¯å˜å¾—ç®€å•ã€‚å®ƒå¯ä»¥é€šè¿‡å®éªŒæ€§åŠŸèƒ½æ ‡å¿—åœ¨NextJS 10+ä¸­ä½¿ç”¨ï¼Œå®ƒä½¿é›†æˆå¾®å‰ç«¯å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚ä½ é¦–å…ˆæ„å»ºä¸€ä¸ªå¤–éƒ¨çš„å¾®å‰ç«¯ï¼Œå¹¶å°†å…¶ä½œä¸º<strong>Module federated</strong>éƒ¨ç½²åˆ°ä½ é€‰æ‹©çš„ç›®çš„åœ°ã€‚ç„¶åä½ åœ¨ä½ çš„NextJSåº”ç”¨ç¨‹åºä¸­æ›´æ–°ä¸€äº›é…ç½®ï¼Œå‰©ä¸‹çš„ç”±Webpackå®Œæˆã€‚è¿™æœ‰ç‚¹ç¥å¥‡ğŸ¦„ã€‚</p>
<p>æˆ‘ä¸ä¼šæ·±å…¥ç ”ç©¶å®ƒä»¬æ˜¯ä»€ä¹ˆï¼ˆè¿™ä¸ªè¯é¢˜éå¸¸å¹¿æ³›ï¼Œè€Œä¸”æœ‰æ›´å¤šåˆæ ¼çš„èµ„æ–™ï¼‰ï¼Œè€Œæ˜¯ç ”ç©¶å¦‚ä½•åœ¨NextJSåº”ç”¨ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ªå¾®å‰ç«¯ã€‚ä¸ºäº†è¥é€ æ°”æ°›ï¼Œè¿™é‡Œè¯•å›¾å›´ç»•ç½‘ç»œåº”ç”¨å’Œå¾®å‰ç«¯å‡ºç°çš„æ—¶é—´åšä¸€ä¸ªç®€çŸ­çš„å†å²å›é¡¾ã€‚</p>
<h2 id="æ—¶é—´çº¿">æ—¶é—´çº¿</h2>
<ul>
<li>
<p>2000å¹´</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒWebåº”ç”¨ç¨‹åºé€šå¸¸æ˜¯åˆ©ç”¨Railsæˆ–Djangoç­‰æ¡†æ¶çš„å•ä½“åº”ç”¨æ¥æ„å»ºçš„ã€‚æ—©æœŸçš„Twitterã€Instagramå’ŒGithubå°±æ˜¯ä¸€äº›ä¾‹å­ã€‚</p>
</li>
<li>
<p>2011å¹´</p>
<p>ç„¶åï¼Œå¾®æœåŠ¡å¼€å§‹å°è¯•å¹¶å¤§è§„æ¨¡è§£å†³ç»„ç»‡é—®é¢˜ï¼Œä¾‹å¦‚å®ç°æ›´å¤§çš„å›¢é˜Ÿè‡ªä¸»æ€§ï¼Œä»¥åŠä¸€äº›æŠ€æœ¯é—®é¢˜ï¼Œå¦‚æ”¹è¿›çš„æ•…éšœéš”ç¦»å’Œæ‰©å±•æ€§ã€‚</p>
<p><em>â€å¾®æœåŠ¡â€œæœ¬èº«æ˜¯åœ¨2011å¹´çš„ä¸€æ¬¡è½¯ä»¶æ¶æ„å¸ˆæ´»åŠ¨ä¸­é¦–æ¬¡äº®ç›¸ï¼Œè¯¥æœ¯è¯­ç”¨äºæè¿°å½“æ—¶è®¸å¤šä¸ä¼šè€…æ­£åœ¨å°è¯•çš„ä¸€ç§æ¶æ„é£æ ¼ã€‚Netflixå’Œäºšé©¬é€Šæ˜¯å¾®æœåŠ¡çš„æ—©æœŸå…ˆé©±ä¹‹ä¸€ã€‚</em></p>
</li>
<li>
<p>2012å¹´</p>
<p>Reactçš„å‡ºç°ä¸ºé«˜æ€§èƒ½çš„å®¢æˆ·ç«¯Webåº”ç”¨ç¨‹åºä»¥åŠä¸å¯é¿å…çš„å•ä¸€å‰ç«¯é“ºå¹³äº†é“è·¯ã€‚</p>
</li>
<li>
<p>2016å¹´</p>
<p>ThoughtWorkså¼€å§‹è¯„ä¼°ä¸€ç§ç§°ä¸ºâ€å¾®å‰ç«¯â€œçš„æ–°æŠ€æœ¯ï¼Œä»¥è·å¾—ä¸å¾®æœåŠ¡æä¾›çš„ç±»ä¼¼å¥½å¤„ï¼Œä½†ç”¨äºå‰ç«¯ã€‚</p>
</li>
<li>
<p>2020å¹´</p>
<p>webpack5å‘å¸ƒï¼Œ<strong>Module Federated</strong>ä¸ºç›¸å¯¹å¹´è½»çš„å¾®å‰ç«¯èŒƒä¾‹æ‰“å¼€äº†æ–°çš„å¯èƒ½æ€§ã€‚</p>
</li>
</ul>
<h2 id="nextjsåº”ç”¨ç¨‹åºä¸­çš„å¾®å‰ç«¯">NextJSåº”ç”¨ç¨‹åºä¸­çš„å¾®å‰ç«¯</h2>
<p>æ‰€ä»¥å¾®å‰ç«¯å®é™…ä¸Šå·²ç»å­˜åœ¨äº†ä¸€æ®µæ—¶é—´ï¼Œå¹¶ä»¥å„ç§æ–¹å¼å®ç°ã€‚Webpack5åŠå…¶<strong>Module Federated</strong>åŠŸèƒ½æ˜¯ç”Ÿæ€ç³»ç»Ÿä¸­è¾ƒæ–°ä¸”ä»¤äººå…´å¥‹çš„æ–°å¢åŠŸèƒ½ä¹‹ä¸€ã€‚</p>
<p><em>æ³¨æ„ï¼šæˆ‘å¯ä»¥äº¤æ›¿ä½¿ç”¨â€å¾®å‰ç«¯â€œå’Œ<strong>module ferdertion</strong>è¿™ä¸¤ä¸ªæœ¯è¯­</em></p>
<h3 id="è¦æ±‚">è¦æ±‚</h3>
<p>è¦åœ¨NextJSåº”ç”¨ç¨‹åºä¸­å®ç°å¾®å‰ç«¯ï¼Œä½ éœ€è¦ä½¿ç”¨NextJSæˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªferderated module</p>
<h3 id="å¾®å‰ç«¯">å¾®å‰ç«¯</h3>
<p>æˆ‘ç‰¹å®šçš„å¾®å‰ç«¯&ndash;ä¸€ä¸ªç®€å•çš„æŒ‰é’®&ndash;æ˜¯å®˜æ–¹è”åˆæ¨¡å—åŒå‘ç¤ºä¾‹çš„æœ€å°ä¿®æ”¹åˆ†æ”¯ã€‚</p>
<p>å®ƒå»ºç«‹åè¢«æ‹–å…¥å…¬å…±çš„AWS S3æ¡¶ï¼Œä½œä¸ºä¸€ä¸ªå¿«é€Ÿçš„æ¦‚å¿µéªŒè¯ã€‚å¤§éƒ¨åˆ†é…ç½®åœ¨å¸¦æœ‰ModuleFederationPluginçš„webpack.config.jsä¸­ã€‚</p>
<p>webpack.config.js</p>
<pre><code>const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;)
const { ModuleFederationPlugin } = require(&quot;webpack&quot;).container
const path = require('path')
const deps = require('./package.json').dpendencies

module.exports = {
    entry: './scr/index',
    mode: 'development',
    devServer: {
        contentBase: path.join(__dirname, 'dist'),
        port: 3002,
    },
    output: {
        publicPath: 'auto',
    },
    resolve: {
        extensions: ['.tsx', '.ts', '.js'],
    },
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                loader: &quot;ts-loader&quot;,
                include: path.resolve(__dirname, 'src'),
                exclude: /node_modules/,
            },
            {
                test: /\.jsx?$/,
                loader: 'babel-loader',
                exclude: /node_modules/,
                options: {
                    presets: ['@babel/preset-react'],
                },
            },
            {
                test: /\.css$/i,
                use: ['style-loader', 'css-loader']
            },
        ],
    },
    plugins: [
        new ModuleFederationPlugin({
            name: &quot;app2&quot;,
            filename: &quot;remoteEntry.js&quot;,
            exposes: {
                './Button': './src/Button',
                './Tree': './src/FileTree/Tree',
                './Folder': './src/FileTree/Folder',
                './File': './src/FileTree/File'
            },
            shared: [
                {
                    ...deps,
                    react: {
                        // eager: true
                        singleton: true,
                        requiredVersion: deps.react,
                    },
                    &quot;react-dom&quot;: {
                        // eager: true
                        singleton: true,
                        requiredVersion: deps['react-dom']
                    },
                },
            ],
        }),
        new HtmlWebpackPlugin({
            template: './public/index.html'
        })
    ]
}
</code></pre>
<p><strong>æ³¨æ„</strong>: name, filename, exposeså­—æ®µå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä»¬å°†è¢«æ¶ˆè´¹åº”ç”¨å¼•ç”¨ã€‚</p>
<h3 id="åº”ç”¨ç¨‹åº">åº”ç”¨ç¨‹åº</h3>
<p>NextJS 10 é…å¤‡äº†Webpack5ï¼Œä½œä¸ºä¸€ä¸ªå®éªŒæ€§çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªåŠŸèƒ½æ ‡å¿—æ¥å¯ç”¨ã€‚
NextJS 11 é»˜è®¤å¸¦æœ‰Webpack5ï¼Œæ— éœ€è¦é…ç½®</p>
<h4 id="å®‰è£…nextjs-10">å®‰è£…NextJS 10+</h4>
<pre><code>yarn add next@latest
</code></pre>
<p>åœ¨next.config.jsä¸­å°†future.webpack5æ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œå¹¶æ¨é€ä¸€ä¸ªæ–°çš„ModuleFederationPluginåˆ°æ’ä»¶åˆ—è¡¨ã€‚</p>
<p><strong>è­¦å‘Š</strong>ï¼šè¿™ä¸æ˜¯é’ˆå¯¹Next 10çš„æ–‡ä»¶ï¼</p>
<pre><code>module.exports = {
    // if on Next 10
    future: {
        webpack5: ture,
    },
    // if on Next 11
    webpack5: true,    // é»˜è®¤æ˜¯trueï¼Œæ‰€ä»¥ä½ å¯ä»¥å¿½ç•¥è¿™ä¸ª
    webpack(config, options): {
        /** Webpack5 **/
        console.log(options.webpack.version)
        
        const { ModuleFederationPlugin } = options.webpack.container;
        
        config.plugins.push(
            new ModuleFederationPlugin({
                remotes: {
                    app2: &quot;app2@https://kevinmfe.s3.amazonaws.com/app2/dist/remoteEntry.js&quot;,
                },
                shared: [],
            })
        );
        return config;
    }
}
</code></pre>
<p>remoteså­—æ®µå…è®¸æ¶ˆè´¹è€…åº”ç”¨ç¨‹åºå¯¼å…¥è”åˆæ¨¡å—ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯è”åˆæ¨¡å—çš„nameå’Œfilenameï¼š</p>
<pre><code>`{someKey}: {name}@domain/path/to/{file}`
</code></pre>
<h3 id="æ‰§è¡Œ">æ‰§è¡Œ</h3>
<p>è¦å¯¼å…¥ä¸€ä¸ªè”åˆæ¨¡å—ï¼Œä½ å¯ä»¥ä½¿ç”¨dynamicã€‚ä»»ä½•åŒ…å«åœ¨è”åˆæ¨¡å—çš„exposeså­—æ®µä¸­çš„æ¨¡å—éƒ½å¯ä»¥åœ¨å¯¼å…¥è·¯å¾„ä¸­ä½¿ç”¨ï¼š</p>
<pre><code>`{someKey}/{exposes.Button|exposes/SomeModule|etc.}`
</code></pre>
<p>.src/pages/[year]/[month]/[day]/[slug.tsx]</p>
<pre><code>import dynamic from 'next/dynamic'

// è¿™ä¸React.lazy()çš„è¡Œä¸ºæˆ–å¤šæˆ–å°‘ç›¸åŒ
// å’Œ &lt;React.Suspense&gt;ï¼Œæˆ– react-loadable

const MfeButton = dynamic(
    async () =&gt; {
        await new Promise((res) =&gt; setTimeout(res, 1500))
        return await import('app2/button')
    },
    {
        ssr: false,
        loading: ({ error }) =&gt; {
            if (error) {
                return &lt;Error label={error.name}&gt;{error.message}&lt;/Error&gt;
            }
            return &lt;Skeleton&gt;&lt;/Skeleton&gt;
        }
    }
)

const mdxComponents = {
    MfeButton: dynamic(() =&gt; import('app2/Button'), {
        ssr: false,
        loading: () =&gt; &lt;Skeleton&gt;&lt;/Skeleton&gt;,
    }),
}

export default function MyPage() {
    return &lt;MfeButton label={&quot;a label prop&quot;} /&gt;
}
</code></pre>
<p>ä»¥ä¸‹æ˜¯æœ¬ç½‘ç«™å®é™…çš„å¾®å‰ç«¯å®ç°å›¾ã€‚ç›®å‰ï¼Œè¯¥æ¡†æ¶æ˜¯éå¸¸åŸºæœ¬çš„ï¼Œä½†å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•åˆ°åŒ…æ‹¬è¯¸å¦‚ç”¨äºå¾®å‰ç«¯å­˜å‚¨æ¡¶çš„ä¸“ç”¨CloudFrontåˆ†å‘ã€ç”¨äºæœåŠ¡å™¨ç«¯æ¸²æŸ“ç´æ–­çš„Lambda@Edgeæˆ–ç”¨äºå•ä¸ªå¾®å‰ç«¯æ•°æ®éœ€æ±‚çš„Apiç½‘ç®¡ç­‰å†…å®¹ã€‚</p>
<p><img src="https://thekevinwang.com/image/2021/03/26/mfe_dark.webp" alt="image"></p>
<h2 id="ç»éªŒä¹‹è°ˆ">ç»éªŒä¹‹è°ˆ</h2>
<p>è¿™æ˜¯ä¸€ä¸ªæ¦‚å¿µè¯æ˜ï¼Œè¯´æ˜å°†è”åˆæ¨¡å—/å¾®å‰ç«¯é›†æˆåˆ°NextJSåº”ç”¨ç¨‹åºä¸­æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚å°½ç®¡æ˜¯ä¸€ä¸ªè¿‡äºç®€å•çš„ä¾‹å­ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ¢ç´¢æ€§é¡¹ç›®ã€‚</p>
<p>è¯´åˆ°è¿™é‡Œï¼Œæœ€åˆç”±ä¸€ä¸ªå¿ƒç†éšœç¢ï¼Œæœ‰ç‚¹éš¾ä»¥å®¢æˆ·ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰æ„è¯†åˆ°å¾®å‰ç«¯çš„ä¸»é¢˜/æ¨¡å¼æœ‰å¤šä¹ˆå¹¿æ³›ã€‚Webpack5å’Œè”åˆæ¨¡å—ä»…å ä¸»é¢˜çš„ä¸€å°éƒ¨åˆ†ã€‚</p>
<p>Webpack5ç”Ÿæ€ç³»ç»Ÿä»å¤„äºèµ·æ­¥é˜¶æ®µï¼Œæœ€å¤§çš„çŸ¥è¯†æ¥æºæ˜¯å†’é™©çš„æ—©æœŸé‡‡ç”¨è€…çš„åšå®¢æ–‡ç« ã€‚å›´ç»•è¯¥ä¸»é¢˜çš„Stack Overflowå¸–å­ä¹Ÿéå¸¸æœ‰é™ã€‚</p>
<p>æˆ‘ä»ç„¶æƒ³äº²è‡ªæ¢ç´¢çš„äº‹æƒ…æ˜¯ï¼š</p>
<pre><code>è·¨å¤šä¸ªä¸ç›¸å…³çš„å¾®å‰ç«¯å…±äº«ååº”çŠ¶æ€ç®¡ç†

åœ¨ä¸åŒçš„æ¡†æ¶ä¸­åˆ›å»ºå¾®å‰ç«¯ï¼Œå¦‚Vueã€Angularæˆ–React Native Web

å¯¼å…¥æ‰€è¿°å¾®å‰ç«¯

æœåŠ¡å™¨ç«¯æ¸²æŸ“è”åˆæ¨¡å—

ä»å•ä¸ªè”åˆæ¨¡å—ä¸­è·å–æ•°æ®

æˆåŠŸæ¸²æŸ“ä½¿ç”¨çŠ¶æ€é’©å­çš„å¤šä¸ªè”åˆReactå‡½æ•°ç»„ä»¶çš„æ ‘

æˆåŠŸæ¸²æŸ“å¤šä¸ªè”åˆReactæœ‰çŠ¶æ€ç±»ç»„ä»¶çš„æ ‘
</code></pre>
<h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<p>åŠ¨æ€å¯¼å…¥è”åˆæ¨¡å—ä¼šä¸¢å¤±é™æ€ç±»å‹æ£€æŸ¥ã€‚ä½†æ˜¯ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°é€šè¿‡å°†é™æ€ç±»å‹å‘å¸ƒåˆ°npmæ¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« å’Œæ˜¾ç¤ºçš„è®¾ç½®ä¸­ï¼Œæˆ‘ä¼¼ä¹æ— æ³•å¾—åˆ°ä¸€ä¸ªä½¿ç”¨hookçš„è”åˆReactç»„ä»¶çš„æ­£å¸¸å·¥ä½œç¤ºä¾‹ï¼Œå¹¶ä¸”å®ƒä¼¼ä¹æ˜¯ModuleFederationPluginå’Œä¸€äº›NextJSå†…éƒ¨å·¥ä½œä¹‹é—´å›ºæœ‰çš„ä¸å…¼å®¹/é™åˆ¶</p>
<pre><code>react.development.js:1476 Uncaught Error: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.
</code></pre>
<p>æˆ‘å°è¯•äº†å¤šç§é€‰é¡¹ï¼ŒåŒ…æ‹¬ä¸€äº›è‡ªå®šä¹‰åŠ è½½ç»„ä»¶ï¼Œå¹¶æˆåŠŸå‘ˆç°äº†ä½¿ç”¨useState hookçš„å•èº«æ—ç»„ä»¶ï¼Œä½†è§£å†³æ–¹æ¡ˆå¤ªå¤æ‚ï¼Œæ— æ³•ç»´æŠ¤IMOã€‚ç”Ÿæ€ç³»ç»Ÿä»ç„¶éå¸¸ä¸æˆç†Ÿï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›å¾ˆå¿«å°±ä¼šæœ‰æ›´å¤šå…³äºæ­¤çš„å®˜æ–¹æ¨¡å¼å‡ºç°ã€‚</p>
<p>Seeï¼š<a href="https://stackoverflow.com/questions/63942391/webpack-5-module-federation-hooks-in-remote-module-not-working">https://stackoverflow.com/questions/63942391/webpack-5-module-federation-hooks-in-remote-module-not-working</a></p>
<h2 id="è°ƒè¯•">è°ƒè¯•</h2>
<p>åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ï¼Œä½ å¯ä»¥è¿è¡Œå®ƒæ¥æ£€æŸ¥è”åˆæ¨¡å—çš„å­˜åœ¨</p>
<pre><code>window.app2.get(&quot;./Button&quot;).then(factory =&gt; factory()).then(mod =&gt; console.log(mod))

Module {__esModule: true, Symbol(Symbol.toStringTag): &quot;Module&quot;} â„¹ï¸
    default: (...)
    Symbol(Symbol.toStringTag): &quot;Module&quot;
    __esModule: true
â–¶ï¸ get default: ()=&gt;a
â–¶ï¸ __proto__: Object</code></pre>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script>
 
 
 
 window.onload = function () {
   const header = document.getElementById('post-header');
   const headerHeight = header.offsetHeight;
   
   document.documentElement.style.scrollPaddingTop = headerHeight + 10 + "px";
 }

 const tocToggleButton = document.getElementById("toc-toggle");

 const tippyInstance = tippy('#toc-toggle', {
  trigger: 'click',
  content: '<div id="table-of-contents">\u003cnav id=\u0022TableOfContents\u0022\u003e\n  \u003cul\u003e\n    \u003cli\u003e\u003ca href=\u0022#æ—¶é—´çº¿\u0022\u003eæ—¶é—´çº¿\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#nextjsåº”ç”¨ç¨‹åºä¸­çš„å¾®å‰ç«¯\u0022\u003eNextJSåº”ç”¨ç¨‹åºä¸­çš„å¾®å‰ç«¯\u003c\/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\u0022#è¦æ±‚\u0022\u003eè¦æ±‚\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#å¾®å‰ç«¯\u0022\u003eå¾®å‰ç«¯\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#åº”ç”¨ç¨‹åº\u0022\u003eåº”ç”¨ç¨‹åº\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#æ‰§è¡Œ\u0022\u003eæ‰§è¡Œ\u003c\/a\u003e\u003c\/li\u003e\n      \u003c\/ul\u003e\n    \u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#ç»éªŒä¹‹è°ˆ\u0022\u003eç»éªŒä¹‹è°ˆ\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#æ³¨æ„äº‹é¡¹\u0022\u003eæ³¨æ„äº‹é¡¹\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#è°ƒè¯•\u0022\u003eè°ƒè¯•\u003c\/a\u003e\u003c\/li\u003e\n  \u003c\/ul\u003e\n\u003c\/nav\u003e</div>',
  allowHTML: true,
  placement: 'bottom-start',
  interactive: true,
  arrow: false,
  maxWidth: "none",
  onHide: function () { tocToggleButton.classList.remove("hover"); },
  onShow: function () { tocToggleButton.classList.add("hover"); },
  onShown: function () {
    selectTableOfContentsOption();

    if (window.hasSetupTableOfContentsListeners) {
      return;
    }

    const tableOfContents = document.getElementById("table-of-contents");
    tableOfContents.addEventListener('click', function () {
      
      tippyInstance[0].hide();
    });

    window.hasSetupTableOfContentsListeners = true;
  }
 });

 function selectTableOfContentsOption () {
   const optionSelectedClass = 'table-of-contents-option-selected';

   const tableOfContentsOptions = document.querySelectorAll("#table-of-contents > nav > ul li");

   for (const option of tableOfContentsOptions) {
     

     const [child] = option.children;
     if (child.tagName.toLowerCase() !== 'a') {
       continue;
     }

     if (window.location.href === child.href) {
       child.classList.add(optionSelectedClass);
     } else {
       child.classList.remove(optionSelectedClass);
     }
   }
 }

 window.onhashchange = selectTableOfContentsOption;
</script>


</body>

<script type="application/javascript" src="https://blog.achirsh.site/js/github-style.js"></script>



</html>